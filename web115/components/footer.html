<!-- components/footer.html -->
<footer>
  <section>
    <p>
      <a href="https://github.com/Itamar96" target="_blank" rel="noopener noreferrer">GitHub</a> ✶
      <a href="https://itamar96.github.io/index.html" target="_blank" rel="noopener noreferrer">GitHub.io</a> ✶
      <a href="https://www.codecademy.com/profiles/Itamar96" target="_blank" rel="noopener noreferrer">Codecademy</a> ✶
      <a href="https://www.freecodecamp.org/itamar96" target="_blank" rel="noopener noreferrer">freeCodeCamp</a> ✶
      <a href="https://jsfiddle.net/u/Itamar96/fiddles/" target="_blank" rel="noopener noreferrer">JSFiddle</a> ✶
      <a href="https://www.linkedin.com/in/itamar-castillo-6137b8380/" target="_blank" rel="noopener noreferrer">LinkedIn</a>
      <span id="validate-link-placeholder"></span>
    </p>
    <p><em>Page built by Iridescent Cinderwyrm Design</em></p>
  </section>
</footer>
<!-- Centralized scripts: include loader, theme toggle, and active link highlight -->
<script>
  (function () {
    // ensure includeHTML exists: if not, load it once and then call includeHTML
    function ensureIncludes(cb) {
      if (typeof includeHTML === 'function') return cb();
      if (document.querySelector('script[data-htmlinclude]')) return setTimeout(() => ensureIncludes(cb), 60);
      const s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/gh/Paul-Browne/HTMLInclude/include.min.js';
      s.setAttribute('data-htmlinclude', '1');
      s.onload = () => { if (typeof includeHTML === 'function') includeHTML(); cb(); };
      s.onerror = cb;
      document.head.appendChild(s);
    }

    function persistTheme(isDark) {
      try { localStorage.setItem('ic-dark', isDark ? '1' : '0'); } catch (e) {}
    }

    function readPersistedTheme() {
      try { return localStorage.getItem('ic-dark') === '1'; } catch (e) { return false; }
    }

    function initUI() {
      const toggle = document.getElementById('theme-toggle');
      // apply persisted theme first
      const persisted = readPersistedTheme();
      if (persisted) document.body.classList.add('dark-theme');

      if (toggle) {
        const isDark = document.body.classList.contains('dark-theme');
        toggle.setAttribute('aria-pressed', isDark ? 'true' : 'false');
        if (!toggle.dataset.hasHandler) {
          toggle.addEventListener('click', () => {
            const nowDark = document.body.classList.toggle('dark-theme');
            toggle.setAttribute('aria-pressed', nowDark ? 'true' : 'false');
            persistTheme(nowDark);
          });
          toggle.dataset.hasHandler = 'true';
        }
      }

      // highlight nav link robustly
      const current = window.location.pathname.split('/').pop() || 'index.html';
      document.querySelectorAll('nav a').forEach(a => {
        try {
          if (a.getAttribute('href') === current) a.setAttribute('aria-current', 'page');
        } catch (e) {}
      });

      // Insert a dynamic "Validate this page" link that targets the W3C validator
      try {
        const placeholder = document.getElementById('validate-link-placeholder');
        if (placeholder && !placeholder.dataset.inserted) {
          const validator = document.createElement('a');
          const currentHref = window.location.href;
          const encoded = encodeURIComponent(currentHref);
          validator.href = 'https://validator.w3.org/nu/?doc=' + encoded;
          validator.target = '_blank';
          validator.rel = 'noopener noreferrer';
          validator.className = 'footer-link';
          validator.textContent = 'Validate this page';
          // add a separator
          const sep = document.createElement('span'); sep.textContent = ' ✶ '; sep.setAttribute('aria-hidden', 'true');
          placeholder.appendChild(sep);
          placeholder.appendChild(validator);
          placeholder.dataset.inserted = '1';
        }
      } catch (e) { /* non-fatal */ }
    }

    // Run includes then init UI. Also run init on DOMContentLoaded as fallback.
    ensureIncludes(() => setTimeout(initUI, 40));
    document.addEventListener('DOMContentLoaded', initUI);
  })();
</script>
